

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Qcircuits.src.core &mdash; Qcircuits  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Qcircuits
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../API/API.html">API of the Qcircuits package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Qcircuits</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>Qcircuits.src.core</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Qcircuits.src.core</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">sympy.utilities.lambdify</span> <span class="k">import</span> <span class="n">lambdify</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="k">import</span> <span class="n">e</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">hbar</span>
<span class="kn">from</span> <span class="nn">sympy.core.mul</span> <span class="k">import</span> <span class="n">Mul</span><span class="p">,</span> <span class="n">Pow</span><span class="p">,</span> <span class="n">Add</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="k">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">floor</span><span class="p">,</span> <span class="n">factorial</span>
<span class="kn">from</span> <span class="nn">Qcircuits.src</span> <span class="k">import</span> <span class="n">_gui</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">Qcircuits.src._constants</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Qcircuits.src._utility</span> <span class="k">import</span> <span class="n">pretty_value</span><span class="p">,</span>\
        <span class="n">check_there_are_no_iterables_in_kwarg</span><span class="p">,</span>\
        <span class="n">shift</span><span class="p">,</span>\
        <span class="n">to_string</span><span class="p">,</span>\
        <span class="n">safely_evaluate</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">PROFILING</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">timed</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">te</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">PROFILING</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;calling </span><span class="si">%r</span><span class="s1"> took </span><span class="si">%2.2f</span><span class="s1"> ms&#39;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">(</span><span class="n">te</span> <span class="o">-</span> <span class="n">ts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">timed</span>

<span class="k">def</span> <span class="nf">string_to_component</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">W</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">L</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">J</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">C</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">G</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>

<span class="n">plot_parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;figsize_scaling&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">light_black</span><span class="p">,</span>
    <span class="s2">&quot;x_fig_margin&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;y_fig_margin&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;gap&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">6</span>
    <span class="p">},</span>
    <span class="s2">&quot;J&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.22</span><span class="p">,</span>
        <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">6</span>
    <span class="p">},</span>
    <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="s2">&quot;N_points&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
        <span class="s2">&quot;N_turns&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="s2">&quot;N_points&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
        <span class="s2">&quot;N_ridges&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;side_wire_width&quot;</span><span class="p">:</span> <span class="mf">0.25</span>
    <span class="p">},</span>
    <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="mi">12</span>
    <span class="p">},</span>
    <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;text_position_horizontal&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">0.22</span><span class="p">],</span>
        <span class="s2">&quot;text_position_vertical&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.22</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">pp</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">plot_parameters</span><span class="p">)</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">1.25</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;figsize_scaling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="s2">&quot;gap&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;J&quot;</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;text_position_horizontal&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.07</span><span class="p">],</span>
        <span class="s2">&quot;text_position_vertical&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">]</span>
    <span class="p">}</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">blue</span><span class="p">,</span>
        <span class="s2">&quot;y_arrow&quot;</span><span class="p">:</span> <span class="n">pp</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.08</span><span class="p">,</span>
        <span class="s2">&quot;text_position_horizontal&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.25</span><span class="p">],</span>
        <span class="s2">&quot;text_position_vertical&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="o">-</span><span class="mf">0.07</span><span class="p">]</span>
    <span class="p">}</span>
<span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_arrow&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;min_width&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s2">&quot;max_width&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s2">&quot;min_lw&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;max_lw&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;min_head&quot;</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span>
        <span class="s2">&quot;max_head&quot;</span><span class="p">:</span> <span class="mf">0.071</span><span class="p">,</span>
        <span class="s2">&quot;color_positive&quot;</span><span class="p">:</span> <span class="n">blue</span><span class="p">,</span>
        <span class="s2">&quot;color_negative&quot;</span><span class="p">:</span> <span class="n">blue</span>
    <span class="p">}</span>
<span class="n">plot_parameters_normal_modes</span> <span class="o">=</span> <span class="n">pp</span>

<div class="viewcode-block" id="Qcircuit"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit">[docs]</a><span class="k">class</span> <span class="nc">Qcircuit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for BBQcircuit&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netlist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span> <span class="o">=</span> <span class="n">netlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">_Network</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inductors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacitors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resistors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wires</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_value_components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">netlist</span><span class="p">:</span>
            <span class="n">elt</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">elt</span><span class="o">.</span><span class="n">set_component_lists</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_elt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inductors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_elt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inductors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;There should be at least one junction or inductor in the circuit&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacitors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;There should be at least one capacitor in the circuit&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flux_transformation_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux_transformation_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compute_Y</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_dY_analytically</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">compute_char_poly_coeffs</span><span class="p">(</span><span class="n">is_lossy</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resistors</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">lambdify</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span><span class="p">]</span>

<div class="viewcode-block" id="Qcircuit.compute_Y"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.compute_Y">[docs]</a>    <span class="nd">@timeit</span>
    <span class="k">def</span> <span class="nf">compute_Y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">admittance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_elt</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_elt</span><span class="o">.</span><span class="n">node_plus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y_lambdified</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
        <span class="n">Y_together</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>    <span class="c1"># Puts everything on a single fraction with the numerator and denomenator as polynomials</span>
                                            <span class="c1"># So it combines but also &quot;de-nests&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1"># Write numerator as polynomial in omega</span>
        <span class="n">Y_numer</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">numer</span><span class="p">(</span><span class="n">Y_together</span><span class="p">)</span>
        <span class="n">Y_numer_poly</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">Y_numer</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>
        <span class="c1"># Write numerator as polynomial in omega</span>
        <span class="n">Y_denom</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">denom</span><span class="p">(</span><span class="n">Y_together</span><span class="p">)</span>
        <span class="n">Y_denom_poly</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">Y_denom</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_order</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">polytools</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span>
            <span class="n">Y_numer_poly</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>  <span class="c1"># Order of the polynomial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_order</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">polytools</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span>
            <span class="n">Y_denom_poly</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>  <span class="c1"># Order of the polynomial</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_coeffs_analytical</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_numer_poly</span><span class="o">.</span><span class="n">coeff</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_order</span><span class="o">+</span><span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># Get polynomial coefficients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">lambdify</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_coeffs_analytical</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_coeffs_analytical</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_denom_poly</span><span class="o">.</span><span class="n">coeff</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_order</span><span class="o">+</span><span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># Get polynomial coefficients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">lambdify</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_coeffs_analytical</span><span class="p">]</span></div>

<div class="viewcode-block" id="Qcircuit.compute_dY_analytically"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.compute_dY_analytically">[docs]</a>    <span class="nd">@timeit</span>
    <span class="k">def</span> <span class="nf">compute_dY_analytically</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># derivative of u/v is (du*v-dv*u)/v^2 = du/v since u=0 everywhere we </span>
        <span class="c1"># want this evaluated</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">a</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_order</span><span class="o">-</span><span class="n">n</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_coeffs_analytical</span><span class="p">)])</span>
        <span class="n">du</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_order</span><span class="o">-</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_order</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_coeffs_analytical</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dY_analytical</span> <span class="o">=</span> <span class="n">du</span><span class="o">/</span><span class="n">v</span></div>

<div class="viewcode-block" id="Qcircuit.dY"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.dY">[docs]</a>    <span class="k">def</span> <span class="nf">dY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="nd">@safely_evaluate</span>
        <span class="k">def</span> <span class="nf">dY_single</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># derivative of u/v is (du*v-dv*u)/v^2 = du/v since u=0</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="nb">complex</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span> <span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_denom_poly_coeffs</span><span class="p">],</span><span class="n">w</span><span class="p">)</span>
            <span class="n">du</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">([</span><span class="nb">complex</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span> <span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_numer_poly_coeffs</span><span class="p">]),</span><span class="n">w</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">du</span><span class="o">/</span><span class="n">v</span>
        
        <span class="c1"># test if w is an iterable</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">iter</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># iterable = False</span>
            <span class="k">return</span> <span class="n">dY_single</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># iterable = True</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dY_single</span><span class="p">(</span><span class="n">w_single</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">w_single</span> <span class="ow">in</span> <span class="n">w</span><span class="p">])</span></div>
  
<div class="viewcode-block" id="Qcircuit.w_k_A_chi"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.w_k_A_chi">[docs]</a>    <span class="k">def</span> <span class="nf">w_k_A_chi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">list_element</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">list_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">iter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">iterable</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iterable</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">iterable</span> <span class="ow">and</span> <span class="n">list_element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">list_element</span> <span class="o">=</span> <span class="n">el</span>
                <span class="n">list_values</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">iterable</span> <span class="ow">and</span> <span class="n">list_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;You can only iterate over the value of one element.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pretty_print</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">list_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot pretty print since $</span><span class="si">%s</span><span class="s2">$ does not have a unique value&quot;</span> <span class="o">%</span> <span class="n">list_element</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">list_element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">to_return</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenfrequencies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">loss_rates</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">anharmonicities</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">kerr</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
                <span class="n">N_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_return</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">table_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="n">table_line</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%7s</span><span class="s2"> |&quot;</span>
                <span class="n">table_line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="n">to_print</span> <span class="o">=</span> <span class="n">table_line</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot; freq. &quot;</span><span class="p">,</span> <span class="s2">&quot; diss. &quot;</span><span class="p">,</span> <span class="s2">&quot; anha. &quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">to_return</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">to_print</span> <span class="o">+=</span> <span class="n">table_line</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span><span class="n">pretty_value</span><span class="p">(</span>
                        <span class="n">to_return</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">use_math</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Hz&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>

                <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Kerr coefficients</span><span class="se">\n</span><span class="s2">(diagonal = Kerr, off-diagonal = cross-Kerr)</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="n">table_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_modes</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">table_line</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%7s</span><span class="s2"> |&quot;</span>
                <span class="n">table_line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="n">to_print</span> <span class="o">+=</span> <span class="n">table_line</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">([</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">+</span>
                                               <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   &#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_modes</span><span class="p">)])</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_modes</span><span class="p">):</span>
                    <span class="n">line_elements</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_modes</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">line_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pretty_value</span><span class="p">(</span>
                                <span class="n">to_return</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">use_math</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">line_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">to_print</span> <span class="o">+=</span> <span class="n">table_line</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">line_elements</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">to_return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kerr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">list_values</span><span class="p">:</span>
                <span class="n">kwargs_single</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">kwargs_single</span><span class="p">[</span><span class="n">list_element</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenfrequencies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_single</span><span class="p">))</span>
                <span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loss_rates</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_single</span><span class="p">))</span>
                <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anharmonicities</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_single</span><span class="p">))</span>
                <span class="n">kerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kerr</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_single</span><span class="p">))</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">kerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kerr</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">kerr</span></div>

<div class="viewcode-block" id="Qcircuit.check_kwargs"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.check_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">check_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># # component dict is not defined</span>
            <span class="c1"># elif key in [c.label for _, c in self.component_dict.iteritems()]:</span>
            <span class="c1">#     raise ValueError(</span>
            <span class="c1">#         &#39;The value of %s was already specified when constructing the circuit&#39; % key)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not the label of a circuit element&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;The value of </span><span class="si">%s</span><span class="s1"> should be specified with the keyword argument </span><span class="si">%s</span><span class="s1">=... &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span></div>

<div class="viewcode-block" id="Qcircuit.set_w_cpx"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.set_w_cpx">[docs]</a>    <span class="nd">@timeit</span>
    <span class="k">def</span> <span class="nf">set_w_cpx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">char_poly_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">complex</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span> <span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resistors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># The variable of the characteristic polynomial is w^2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">char_poly_coeffs</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">char_poly_coeffs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)]</span>
                    
        <span class="c1"># Sort solutions with increasing frequency</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">[</span><span class="n">order</span><span class="p">]</span></div>

<div class="viewcode-block" id="Qcircuit.eigenfrequencies"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.eigenfrequencies">[docs]</a>    <span class="k">def</span> <span class="nf">eigenfrequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_w_cpx</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">pi</span></div>

<div class="viewcode-block" id="Qcircuit.loss_rates"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.loss_rates">[docs]</a>    <span class="k">def</span> <span class="nf">loss_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_w_cpx</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">pi</span></div>

<div class="viewcode-block" id="Qcircuit.anharmonicities_per_junction"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.anharmonicities_per_junction">[docs]</a>    <span class="k">def</span> <span class="nf">anharmonicities_per_junction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_w_cpx</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">anharmonicity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">/</span><span class="n">h</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">]</span></div>

<div class="viewcode-block" id="Qcircuit.kerr"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.kerr">[docs]</a>    <span class="k">def</span> <span class="nf">kerr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">As</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anharmonicities_per_junction</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">N_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">)</span>
        <span class="n">N_junctions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">)</span>

        <span class="n">Ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_modes</span><span class="p">,</span> <span class="n">N_modes</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_modes</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_modes</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_junctions</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">Ks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">As</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Ks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.</span> <span class="o">*</span> \
                            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">As</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                                    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">As</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">Ks</span></div>

<div class="viewcode-block" id="Qcircuit.anharmonicities"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.anharmonicities">[docs]</a>    <span class="k">def</span> <span class="nf">anharmonicities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Ks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kerr</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Ks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ks</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span></div>

<div class="viewcode-block" id="Qcircuit.hamiltonian"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.hamiltonian">[docs]</a>    <span class="k">def</span> <span class="nf">hamiltonian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
        <span class="n">modes</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> 
        <span class="n">junc_pot_taylor_exp</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
        <span class="n">excitations</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> 
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">qutip</span> <span class="k">import</span> <span class="n">destroy</span><span class="p">,</span> <span class="n">qeye</span><span class="p">,</span> <span class="n">tensor</span>

        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenfrequencies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">N_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">N_junctions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modes</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">modes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_modes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">excitations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">excitations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">excitations</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>

        <span class="n">H</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">operators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">junction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">]</span>
        <span class="n">qeye_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">qeye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">excitations</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fs</span><span class="p">):</span>
            <span class="n">a_list</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">qeye_list</span><span class="p">)</span>
            <span class="n">a_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">destroy</span><span class="p">(</span><span class="n">excitations</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span>
            <span class="n">operators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">H</span> <span class="o">+=</span> <span class="n">f</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span><span class="o">*</span><span class="n">a</span>
            <span class="n">phi_0</span> <span class="o">=</span> <span class="n">hbar</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">e</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">junction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">):</span>
                <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">junction</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">f</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">/</span><span class="n">phi_0</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">a</span><span class="o">.</span><span class="n">dag</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">junction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">EJ</span> <span class="o">=</span> <span class="p">(</span><span class="n">hbar</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">junction</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
            <span class="k">while</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">junc_pot_taylor_exp</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">EJ</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">H</span></div>

<div class="viewcode-block" id="Qcircuit.show"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">pp</span><span class="o">=</span><span class="n">plot_parameters</span><span class="p">,</span>
             <span class="n">save_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">savefig_kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isinstance</span><span class="p">(</span><span class="n">Network</span><span class="p">):</span>
            <span class="c1">#TODO recognize if the network is of series/parallel type</span>
            <span class="c1"># in which case the circuit can be constructed anyway</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            Plotting functions not available if the circuit was not constructed</span>
<span class="s1">            using the GUI.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="o">=</span> <span class="n">pp</span>

        <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lt</span> <span class="o">=</span> <span class="n">elt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">xs</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="n">ys</span> <span class="o">+=</span> <span class="n">y</span>
            <span class="n">line_type</span> <span class="o">+=</span> <span class="n">lt</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">])</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">])</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">])</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">])</span>

        <span class="n">x_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;x_fig_margin&#39;</span><span class="p">]</span>
        <span class="c1"># ensures that any text labels are not cutoff</span>
        <span class="n">y_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;y_fig_margin&#39;</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
            <span class="p">((</span><span class="n">x_max</span><span class="o">-</span><span class="n">x_min</span><span class="p">)</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">x_margin</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;figsize_scaling&quot;</span><span class="p">],</span>
            <span class="p">((</span><span class="n">y_max</span><span class="o">-</span><span class="n">y_min</span><span class="p">)</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">y_margin</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;figsize_scaling&quot;</span><span class="p">]))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line_type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;diameter&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="n">line_type</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;lw&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>
            <span class="n">elt</span><span class="o">.</span><span class="n">draw_label</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_min</span><span class="o">-</span><span class="n">x_margin</span><span class="p">,</span> <span class="n">x_max</span><span class="o">+</span><span class="n">x_margin</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="o">-</span><span class="n">y_margin</span><span class="p">,</span> <span class="n">y_max</span><span class="o">+</span><span class="n">y_margin</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">full_output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="k">if</span> <span class="n">save_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_to</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">savefig_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Qcircuit.show_normal_mode"><a class="viewcode-back" href="../../../API/circuit_functions.html#Qcircuits.Qcircuit.show_normal_mode">[docs]</a>    <span class="k">def</span> <span class="nf">show_normal_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;current&#39;</span><span class="p">,</span>
                         <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isinstance</span><span class="p">(</span><span class="n">Network</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            Plotting functions not available if the circuit was not constructed</span>
<span class="s1">            using the GUI.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="n">check_there_are_no_iterables_in_kwarg</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_w_cpx</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mode_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_cpx</span><span class="p">[</span><span class="n">mode</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">string_to_function</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;flux&#39;</span><span class="p">:</span>
                <span class="n">phi_0</span> <span class="o">=</span> <span class="n">hbar</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">e</span>
                <span class="k">return</span> <span class="n">comp</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">mode_w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">/</span><span class="n">phi_0</span>
            <span class="k">if</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;charge&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">comp</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span><span class="n">mode_w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">/</span><span class="n">e</span>
            <span class="k">if</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;voltage&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">comp</span><span class="o">.</span><span class="n">voltage</span><span class="p">(</span><span class="n">mode_w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">comp</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="n">mode_w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">pretty</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;flux&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pretty_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$\phi_0$&#39;</span>
            <span class="k">elif</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;charge&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pretty_value</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">use_power_10</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$e$&#39;</span>
            <span class="k">elif</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;voltage&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pretty_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;V&#39;</span>
            <span class="k">elif</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pretty_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;A&#39;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
            <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">pp</span><span class="o">=</span><span class="n">plot_parameters_normal_modes</span><span class="p">)</span>

        <span class="c1"># Determine arrow size</span>
        <span class="n">all_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">W</span><span class="p">):</span>
                <span class="n">all_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string_to_function</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">all_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">value_to_01_range</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">max_value</span> <span class="o">==</span> <span class="n">min_value</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">1.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">-</span><span class="n">min_value</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_value</span><span class="o">-</span><span class="n">min_value</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">arrow_width</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">value_01</span> <span class="o">=</span> <span class="n">value_to_01_range</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">ppnm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;normal_mode_arrow&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;min_width&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">value_01</span><span class="o">*</span><span class="p">(</span><span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;max_width&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;min_width&#39;</span><span class="p">]))</span>

        <span class="k">def</span> <span class="nf">arrow_kwargs</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">value_01</span> <span class="o">=</span> <span class="n">value_to_01_range</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">ppnm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;normal_mode_arrow&#39;</span><span class="p">]</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;min_lw&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">value_01</span><span class="o">*</span><span class="p">(</span><span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;max_lw&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;min_lw&#39;</span><span class="p">])</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;min_head&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">value_01</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;max_head&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">ppnm</span><span class="p">[</span><span class="s1">&#39;min_head&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="n">lw</span><span class="p">,</span>
                    <span class="s1">&#39;head_width&#39;</span><span class="p">:</span> <span class="n">head</span><span class="p">,</span>
                    <span class="s1">&#39;head_length&#39;</span><span class="p">:</span> <span class="n">head</span><span class="p">,</span>
                    <span class="s1">&#39;clip_on&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">W</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">string_to_function</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">value_current</span> <span class="o">=</span> <span class="n">string_to_function</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="n">x</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">x_plot_center</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">y_plot_center</span>

                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mi">180</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="c1"># Defined for positive arrows</span>
                    <span class="n">x_arrow</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">arrow_width</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                    <span class="n">y_arrow</span> <span class="o">=</span> <span class="n">y</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;y_arrow&quot;</span><span class="p">]</span>
                    <span class="n">dx_arrow</span> <span class="o">=</span> <span class="n">arrow_width</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">dy_arrow</span> <span class="o">=</span> <span class="mf">0.</span>

                    <span class="n">x_text</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;text_position_horizontal&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y_text</span> <span class="o">=</span> <span class="n">y</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;text_position_horizontal&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Defined for positive arrows</span>
                    <span class="n">x_arrow</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;y_arrow&quot;</span><span class="p">]</span>
                    <span class="n">y_arrow</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">arrow_width</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                    <span class="n">dx_arrow</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">dy_arrow</span> <span class="o">=</span> <span class="n">arrow_width</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                    <span class="n">x_text</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;text_position_vertical&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y_text</span> <span class="o">=</span> <span class="n">y</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;text_position_vertical&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">value_current</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x_arrow</span><span class="p">,</span> <span class="n">y_arrow</span><span class="p">,</span> <span class="n">dx_arrow</span><span class="p">,</span> <span class="n">dy_arrow</span><span class="p">,</span>
                             <span class="n">fc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;normal_mode_arrow&#39;</span><span class="p">][</span><span class="s1">&#39;color_positive&#39;</span><span class="p">],</span>
                             <span class="n">ec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;normal_mode_arrow&#39;</span><span class="p">][</span><span class="s1">&#39;color_positive&#39;</span><span class="p">],</span>
                             <span class="o">**</span><span class="n">arrow_kwargs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x_arrow</span><span class="o">+</span><span class="n">dx_arrow</span><span class="p">,</span> <span class="n">y_arrow</span><span class="o">+</span><span class="n">dy_arrow</span><span class="p">,</span> <span class="o">-</span><span class="n">dx_arrow</span><span class="p">,</span> <span class="o">-</span><span class="n">dy_arrow</span><span class="p">,</span>
                             <span class="n">fc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;normal_mode_arrow&#39;</span><span class="p">][</span><span class="s1">&#39;color_negative&#39;</span><span class="p">],</span>
                             <span class="n">ec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;normal_mode_arrow&#39;</span><span class="p">][</span><span class="s1">&#39;color_negative&#39;</span><span class="p">],</span>
                             <span class="o">**</span><span class="n">arrow_kwargs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_text</span><span class="p">,</span> <span class="n">y_text</span><span class="p">,</span>
                        <span class="n">pretty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">unit</span><span class="p">),</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;fontsize&quot;</span><span class="p">],</span>
                        <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;normal_mode_label&quot;</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="p">)</span>

        
        <span class="n">w</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">chi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_k_A_chi</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Mode </span><span class="si">%d</span><span class="s1">, f=</span><span class="si">%s</span><span class="s1">Hz, k=</span><span class="si">%s</span><span class="s1">Hz, A=</span><span class="si">%s</span><span class="s1">Hz&#39;</span><span class="o">%</span>
            <span class="p">(</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">pretty_value</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span> <span class="n">use_math</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">pretty_value</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span> <span class="n">use_math</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">pretty_value</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span> <span class="n">use_math</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">),</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> 
            <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_to</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="Network"><a class="viewcode-back" href="../../../API/builders.html#Qcircuits.Network">[docs]</a><span class="k">class</span> <span class="nc">Network</span><span class="p">(</span><span class="n">Qcircuit</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netlist</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Network</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span></div>

<div class="viewcode-block" id="GUI"><a class="viewcode-back" href="../../../API/builders.html#Qcircuits.GUI">[docs]</a><span class="k">class</span> <span class="nc">GUI</span><span class="p">(</span><span class="n">Qcircuit</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">edit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_network</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">edit</span><span class="p">:</span>
            <span class="n">_gui</span><span class="o">.</span><span class="n">open_canvas</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># if file does not exist, also open the gui</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">_gui</span><span class="o">.</span><span class="n">open_canvas</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">netlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">el</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">el</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">netlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">string_to_component</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">set_plot_coordinates</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">print_network</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">W</span><span class="p">)]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span>
                    <span class="n">el</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span><span class="n">el</span><span class="o">.</span><span class="n">node_plus</span><span class="p">),</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span><span class="n">el</span><span class="o">.</span><span class="n">node_plus</span><span class="p">),</span>
                    <span class="n">el</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">use_math</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<span class="k">class</span> <span class="nc">_Network</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The _Network class parses network arrays generated by the GUI</span>
<span class="sd">    or written manually by the user. </span>
<span class="sd">    It allows the computation of an admittance Y of the network between</span>
<span class="sd">    two nodes as well as the voltage transfer function of the network</span>
<span class="sd">    between two ports (4 nodes).</span>
<span class="sd">    Y across an inductor or junction is used to determine the normal-mode </span>
<span class="sd">    frequencies, dissipations and, in conjunction with the transfer function, </span>
<span class="sd">    the zero-point fluctuations of flux (and other variables) between </span>
<span class="sd">    two arbitrary nodes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    netlist : list</span>
<span class="sd">        list of Component objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netlist</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span> <span class="o">=</span> <span class="n">netlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_netlist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There are two sub-circuits which are not connected&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_opens</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analyzing an open/series circuit is impossible |&quot;</span><span class="o">+</span>\
             <span class="s2">&quot; in the language of graphs, there is a dangling vertex in the electrical network&quot;</span><span class="p">)</span>

    <span class="nd">@timeit</span>
    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
        <span class="n">nodes_encountered</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
        <span class="n">start_node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adapted from https://www.python-course.eu/graphs_python.php</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">nodes_encountered</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nodes_encountered</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">)</span> <span class="c1"># &quot;list&quot; necessary in Python 3 </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start_node</span><span class="p">:</span>
            <span class="c1"># chosse a node from graph as a starting point</span>
            <span class="n">start_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nodes_encountered</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">start_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_encountered</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">start_node</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_encountered</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="n">nodes_encountered</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>    

    <span class="k">def</span> <span class="nf">has_opens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">connections</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">connections</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">parse_netlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">merge_chains</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Merges two chains (two arrays)&#39;&#39;&#39;</span>
            <span class="n">to_add</span> <span class="o">=</span> <span class="n">chains</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">chains</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">chains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">chains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">to_add</span>
            <span class="k">return</span> <span class="n">chains</span>

        <span class="c1"># ``chains``` is a list of node-lists (node-list = a chain)</span>
        <span class="c1"># each chain lists nodes which are connected one to another</span>
        <span class="c1"># either through wires or through ground</span>
        <span class="n">chains</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># We start by grouping all nodes which are connected by wires </span>
        <span class="c1"># into chains of nodes indexed by a integer which is to become </span>
        <span class="c1"># the new node names  for future calculations</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>

            <span class="c1"># Go through all the wires (note: grounds are instances of wires)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">W</span><span class="p">):</span>
                
                <span class="c1"># If this element is a ground, call it&#39;s negative node &#39;__ground&#39;</span>
                <span class="n">np</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">node_plus</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="ow">is</span> <span class="n">G</span><span class="p">:</span>
                    <span class="n">nm</span> <span class="o">=</span> <span class="s1">&#39;__ground&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nm</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">node_minus</span>

                <span class="c1"># added tells us if both nodes have already </span>
                <span class="c1"># been added to a same chain</span>
                <span class="n">added</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># go through all chains to see if it</span>
                <span class="c1"># contains the nodes of this wire</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chains</span><span class="p">):</span>

                    <span class="c1"># If both node of the wire have already been </span>
                    <span class="c1"># added to a same chain, don&#39;t do anyting</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">nm</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">):</span>
                        <span class="n">added</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="c1"># If minus node was added to chain &#39;ch&#39;...</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">nm</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ch2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chains</span><span class="p">):</span>
                            <span class="c1"># ...and plus node to chain &#39;ch2&#39;</span>
                            <span class="k">if</span> <span class="n">np</span> <span class="ow">in</span> <span class="n">ch2</span><span class="p">:</span>
                                <span class="c1"># merge the two chains</span>
                                <span class="n">chains</span> <span class="o">=</span> <span class="n">merge_chains</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                                <span class="n">added</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">added</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="c1"># otherwise add plus node to chain &#39;ch&#39;</span>
                            <span class="n">ch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">)</span>
                            <span class="n">added</span> <span class="o">=</span> <span class="kc">True</span>
                    
                    <span class="c1"># same check for the plus node</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">np</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ch2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chains</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">nm</span> <span class="ow">in</span> <span class="n">ch2</span><span class="p">:</span>
                                <span class="n">chains</span> <span class="o">=</span> <span class="n">merge_chains</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                                <span class="n">added</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">added</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="n">ch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span>
                            <span class="n">added</span> <span class="o">=</span> <span class="kc">True</span>
                
                <span class="c1"># if none of the nodes were present in chains, </span>
                <span class="c1"># create a new chain linking the two nodes of the wire</span>
                <span class="k">if</span> <span class="n">added</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nm</span><span class="p">,</span> <span class="n">np</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">plot_node_to_new_node</span><span class="p">(</span><span class="n">plot_node</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Transforms the node ``plot_node``` to a new node.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            plot_node:  typically a string or an integer, but could be any</span>
<span class="sd">                        hashable object</span>
<span class="sd">                        For GUI generated networks, </span>
<span class="sd">                        this is a string &#39;x,y&#39; that determines the position</span>
<span class="sd">                        of the node when plotting it.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            i:          integer, a unique number corresponding to all nodes</span>
<span class="sd">                        connected via a wire or ground.</span>
<span class="sd">                        ``i`` is one of [0,..,N-1] where N is the number of </span>
<span class="sd">                        nodes in the circuit stripped of all wires.</span>
<span class="sd">        </span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># if plot_node is already in a chain, </span>
            <span class="c1"># return the index of that chain in ``chains``</span>
            <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plot_node</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">i</span>
                <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

            <span class="c1"># other wise append ``chains`` and </span>
            <span class="c1"># return the the last index of ``chains``</span>
            <span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">plot_node</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">i</span>

        <span class="c1"># replace plotting nodes with new nodes</span>
        <span class="c1"># for all non-wire elements</span>
        <span class="c1"># and make a list of all nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">node_minus_plot</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">node_minus</span>
            <span class="n">el</span><span class="o">.</span><span class="n">node_plus_plot</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">node_plus</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">W</span><span class="p">):</span>
                <span class="n">el</span><span class="o">.</span><span class="n">node_minus</span> <span class="o">=</span> <span class="n">plot_node_to_new_node</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">node_minus</span><span class="p">)</span>
                <span class="n">el</span><span class="o">.</span><span class="n">node_plus</span> <span class="o">=</span> <span class="n">plot_node_to_new_node</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">node_plus</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">node_plus</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        
        <span class="c1"># build ``net_dict``, a dictionary such that  </span>
        <span class="c1"># ``net_dict[node_A][node_B]`` gives the non-wire circuit </span>
        <span class="c1"># component connecting ``node_A`` and ``node_B``.</span>
        <span class="c1"># If ``node_A`` and ``node_B`` are not connected, </span>
        <span class="c1"># calling ``net_dict[node_A][node_B]`` will raise a KeyError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">W</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">node_plus</span><span class="p">)</span>

    <span class="nd">@timeit</span>
    <span class="k">def</span> <span class="nf">compute_char_poly_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_lossy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        
        <span class="nd">@timeit</span>
        <span class="k">def</span> <span class="nf">determinant</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">matrix</span><span class="o">.</span><span class="n">berkowitz_det</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_lossy</span> <span class="o">=</span> <span class="n">is_lossy</span>
        <span class="n">ntr</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># ntr stands for Network To Reduce</span>

        <span class="c1"># remove nodes which only have on type of element</span>
        <span class="c1"># connections to other nodes</span>
        <span class="n">ntr</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>

        <span class="c1"># compute conductance matrix</span>
        <span class="n">ntr</span><span class="o">.</span><span class="n">compute_RLC_matrices</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lossy</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">char_poly</span> <span class="o">=</span> <span class="n">determinant</span><span class="p">((</span><span class="o">-</span><span class="n">ntr</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">ntr</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">ntr</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]))</span>
            <span class="n">char_poly</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">char_poly</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_order</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">polytools</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span>
                <span class="n">char_poly</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>  <span class="c1"># Order of the polynomial</span>
            <span class="c1"># Get polynomial coefficients, index 0 = highest order term</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span> <span class="o">=</span>\
                <span class="p">[</span><span class="n">char_poly</span><span class="o">.</span><span class="n">coeff</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">char_poly_order</span><span class="o">+</span><span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w2</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;w2&#39;</span><span class="p">)</span>
            <span class="n">char_poly</span> <span class="o">=</span> <span class="n">determinant</span><span class="p">((</span><span class="o">-</span><span class="n">ntr</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">w2</span><span class="o">*</span><span class="n">ntr</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]))</span>
            <span class="n">char_poly</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">char_poly</span><span class="p">),</span> <span class="n">w2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_order</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">polytools</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">char_poly</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="n">w2</span><span class="p">)</span>  <span class="c1"># Order of the polynomial</span>
            <span class="c1"># Get polynomial coefficients, index 0 = highest order term</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span> <span class="o">=</span>\
                <span class="p">[</span><span class="n">char_poly</span><span class="o">.</span><span class="n">coeff</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">char_poly_order</span><span class="o">+</span><span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  
                
        
        <span class="c1"># Divide by w if possible</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">char_poly_order</span><span class="o">+</span><span class="mi">2</span><span class="o">-</span><span class="n">n</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_poly_coeffs_analytical</span>

    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">compute_RLC_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">N_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="n">sp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_nodes</span><span class="p">),</span>
            <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="n">sp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_nodes</span><span class="p">),</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="n">sp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_nodes</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_nodes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">&gt;</span><span class="n">i</span><span class="p">:</span>
                    <span class="n">RLC_matrix_components</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get_RLC_matrix_components</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">RLC_matrix_components</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">RLC_matrix_components</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">RLC_matrix_components</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">RLC_matrix_components</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="c1"># set a ground </span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">row_del</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RLC_matrices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">col_del</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifies the ``net_dict`` variable such that ``node_minus``</span>
<span class="sd">        and ``node_plus`` are marked as connected in future calculations.</span>
<span class="sd">        ``net_dict`` is a dictionary such that  </span>
<span class="sd">        ``net_dict[node_A][node_B]`` gives the non-wire circuit </span>
<span class="sd">        component connecting ``node_A`` and ``node_B``.</span>
<span class="sd">        If ``node_A`` and ``node_B`` are not connected, </span>
<span class="sd">        calling ``net_dict[node_A][node_B]`` will raise a KeyError</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        element:    a ``Circuit`` object which is not a Wire or a Ground</span>
<span class="sd">        node_minus: integer</span>
<span class="sd">                    negative node of the element</span>
<span class="sd">        node_plus: integer</span>
<span class="sd">                    positive node of the element        </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Connect node minus to node plus</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># If the nodes are already connected, add this element in parallel </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_minus</span><span class="p">][</span><span class="n">node_plus</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_minus</span><span class="p">][</span><span class="n">node_plus</span><span class="p">]</span> <span class="o">|</span> <span class="n">element</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Case where the nodes are not connected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_minus</span><span class="p">][</span><span class="n">node_plus</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span>

        <span class="c1"># Connect node plus to node minus</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_plus</span><span class="p">][</span><span class="n">node_minus</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_plus</span><span class="p">][</span><span class="n">node_minus</span><span class="p">]</span> <span class="o">|</span> <span class="n">element</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_plus</span><span class="p">][</span><span class="n">node_minus</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span>

    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_to_remove</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Makes use of the star-mesh transform to remove the ``node_to_remove`` from the network.</span>
<span class="sd">        A node $N$=``node_to_remove`` connected to nodes $A,B,C,..$ through impedances </span>
<span class="sd">        $Z_A,Z_B,...$ (the star) can be eliminated </span>
<span class="sd">        if we interconnect nodes $A,B,C,..$ with impedances $Z_{AB},Z_{AC},Z_{BC},...$</span>
<span class="sd">        given by $Z_{XY} = Z_XZ_Y\sum_M1/Z_M$. </span>
<span class="sd">        The resulting network is called the mesh.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node: integer, node to be removed of the network stored in ``net_dict`` </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># List of (connecting_nodes, connecting_components) connecting the </span>
        <span class="c1"># node_to_remove to (nearest neighbour) connecting_nodes</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_to_remove</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="c1"># Sum of admittances of connecting_components</span>
        <span class="n">sum_Y</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">elt</span><span class="o">.</span><span class="n">admittance</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">])</span>

        <span class="c1"># Go through all pairs of connecting nodes</span>
        <span class="c1"># and calculate the admittance Y_XY that will connect them </span>
        <span class="c1"># in the mesh</span>
        <span class="n">mesh_to_add</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">node_A</span><span class="p">,</span> <span class="n">elt_A</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connections</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">node_B</span><span class="p">,</span> <span class="n">elt_B</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">elt_A</span><span class="o">.</span><span class="n">admittance</span><span class="p">()</span><span class="o">*</span><span class="n">elt_B</span><span class="o">.</span><span class="n">admittance</span><span class="p">()</span><span class="o">/</span><span class="n">sum_Y</span>
                <span class="n">mesh_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">Admittance</span><span class="p">(</span><span class="n">node_A</span><span class="p">,</span> <span class="n">node_B</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">node_A</span><span class="p">,</span> <span class="n">node_B</span><span class="p">])</span>

        <span class="c1"># Remove the node_to_remove from the net_dict, along with all</span>
        <span class="c1"># the connecting components</span>
        <span class="k">for</span> <span class="n">other_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_to_remove</span><span class="p">]:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">other_node</span><span class="p">][</span><span class="n">node_to_remove</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_to_remove</span><span class="p">]</span>

        <span class="c1"># Add admittances Y_XY connecting nodes X,Y directly adjascent to </span>
        <span class="c1"># the removed node</span>
        <span class="k">for</span> <span class="n">mesh_branch</span> <span class="ow">in</span> <span class="n">mesh_to_add</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">mesh_branch</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">admittance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute the admittance of the network between two nodes </span>
<span class="sd">        ``node_plus`` and ``node_minus`` </span>
<span class="sd">        by removing all other nodes through star-mesh transformations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_minus: integer </span>
<span class="sd">        node_plus: integer</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">node_minus</span> <span class="o">==</span> <span class="n">node_plus</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;node_minus == node_plus&#39;</span><span class="p">)</span>

        <span class="c1"># Create a temporary copy of the network which will be reduced</span>
        <span class="n">ntr</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># ntr stands for Network To Reduce</span>

        <span class="c1"># # order nodes from the node with the least amount of connections</span>
        <span class="c1"># # to the one with the most</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ntr</span><span class="o">.</span><span class="n">net_dict</span><span class="p">]</span>
        <span class="n">nodes_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">ntr</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">])</span>
        <span class="n">nodes_sorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes_order</span><span class="p">]</span>
        
        <span class="c1"># Remove all nodes except from node_minus, node_plus</span>
        <span class="c1"># through star-mesh transforms with the remove_node function</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_sorted</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">]:</span>
                <span class="n">ntr</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># Compute the admittance between the two remaining nodes: </span>
        <span class="c1"># node_minus and node_plus</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_minus</span><span class="p">][</span><span class="n">node_plus</span><span class="p">]</span><span class="o">.</span><span class="n">admittance</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Y</span>

    <span class="k">def</span> <span class="nf">branch_admittance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_1</span><span class="p">,</span> <span class="n">node_2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the admittance in the branch connecting ``node_1`` and ``node_2``.</span>
<span class="sd">        If they are not directly connected through a single Component, this function</span>
<span class="sd">        returns 0 (i.e. the admittnce of an open circuit).</span>
<span class="sd">        This function is written to avoid calling try/except clauses repetitivly</span>
<span class="sd">        to verify if ``self.net_dict[node_1][node_2]`` is an existing key</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_1: integer </span>
<span class="sd">        node_2: integer</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">node_1</span> <span class="o">==</span> <span class="n">node_2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;node_1 == node_2&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">node_1</span><span class="p">][</span><span class="n">node_2</span><span class="p">]</span><span class="o">.</span><span class="n">admittance</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.</span>

    <span class="k">def</span> <span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_left_minus</span><span class="p">,</span> <span class="n">node_left_plus</span><span class="p">,</span> <span class="n">node_right_minus</span><span class="p">,</span> <span class="n">node_right_plus</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the transfer function V_right/V_left relating the voltage on </span>
<span class="sd">        a port &#39;right&#39; defined by ``node_right_minus`` and ``node_right_plus``</span>
<span class="sd">        and a port &#39;left&#39; defined by ``node_left_minus`` and ``node_left_plus``</span>
<span class="sd">        We proceed by constructing an ABCD matrix and returning V_right/V_left = 1/A</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_left_minus: integer </span>
<span class="sd">        node_left_plus: integer</span>
<span class="sd">        node_right_minus: integer</span>
<span class="sd">        node_right_plus: integer</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">node_left_minus</span> <span class="o">==</span> <span class="n">node_left_plus</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;node_left_minus == node_left_plus&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node_right_minus</span> <span class="o">==</span> <span class="n">node_right_plus</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;node_right_minus == node_right_plus&#39;</span><span class="p">)</span>

        <span class="c1"># Case where the left an right port are identical</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node_left_minus</span> <span class="o">==</span> <span class="n">node_right_minus</span><span class="p">)</span>\
            <span class="ow">and</span> <span class="p">(</span><span class="n">node_left_plus</span> <span class="o">==</span> <span class="n">node_right_plus</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.</span>

        <span class="c1"># Case where the left an right port are identical, but inverted</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">node_left_plus</span> <span class="o">==</span> <span class="n">node_right_minus</span><span class="p">)</span>\
            <span class="ow">and</span> <span class="p">(</span><span class="n">node_left_minus</span> <span class="o">==</span> <span class="n">node_right_plus</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">1.</span>

        <span class="c1"># If the ports are not identical, reduce the network such that only</span>
        <span class="c1"># the nodes provided as arguments remain</span>

        <span class="c1"># Create a temporary copy of the network which will be reduced        </span>
        <span class="n">ntr</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># ntr stands for Network To Reduce</span>
        
        <span class="c1"># # order nodes from the node with the least amount of connections</span>
        <span class="c1"># # to the one with the most</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ntr</span><span class="o">.</span><span class="n">net_dict</span><span class="p">]</span>
        <span class="n">nodes_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">ntr</span><span class="o">.</span><span class="n">net_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">])</span>
        <span class="n">nodes_sorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes_order</span><span class="p">]</span>

        <span class="c1"># Remove nodes using the star-mesh relation</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_sorted</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node_left_minus</span><span class="p">,</span> <span class="n">node_left_plus</span><span class="p">,</span> <span class="n">node_right_minus</span><span class="p">,</span> <span class="n">node_right_plus</span><span class="p">]:</span>
                <span class="n">ntr</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">node_left_minus</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node_right_plus</span><span class="p">,</span> <span class="n">node_right_minus</span><span class="p">])</span> <span class="ow">or</span>\
            <span class="p">(</span><span class="n">node_left_plus</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node_right_plus</span><span class="p">,</span> <span class="n">node_right_minus</span><span class="p">]):</span>

        <span class="c1"># Case where there are two of the nodes provided as arguments </span>
        <span class="c1"># are identical. </span>
        <span class="c1"># The circuit has then three distinct nodes connected by</span>
        <span class="c1"># three components.</span>
        <span class="c1"># For this case, the ABCD matrix can be constructed following </span>
        <span class="c1"># the before last case of Table 4.1 in Microwave Engineering (Pozar)</span>
        <span class="c1"># Indeed, all these cases are equivelant to the network below:</span>
        <span class="c1">#</span>
        <span class="c1">#  p1   --------- Y_3 ---------- p2 </span>
        <span class="c1">#           |               |</span>
        <span class="c1">#          Y_1             Y_2</span>
        <span class="c1">#           |               |</span>
        <span class="c1">#  gr   ------------------------ gr</span>
        <span class="c1"># Note that the transfer function is independant of Y_1, this in essence </span>
        <span class="c1"># a voltage divider (see https://en.wikipedia.org/wiki/Voltage_divider)</span>
        <span class="c1"># where the voltage at p2 is entirely determined by Y_2,Y_3 and the voltage at p1</span>


            <span class="k">if</span> <span class="n">node_left_minus</span> <span class="o">==</span> <span class="n">node_right_minus</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">node_left_plus</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">node_right_plus</span>
                <span class="n">gr</span> <span class="o">=</span> <span class="n">node_left_minus</span> <span class="c1">#= node_right_minus</span>
                <span class="c1"># Y_1 = ntr.branch_admittance(p1,gr)</span>
                <span class="n">Y_2</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">gr</span><span class="p">)</span>
                <span class="n">Y_3</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>

                <span class="c1"># A component of the ABCD matrix</span>
                <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">Y_2</span><span class="o">/</span><span class="n">Y_3</span> <span class="c1"># node Y_3 cannot be 0 in theory</span>
                <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">A</span>

            <span class="k">elif</span> <span class="n">node_left_plus</span> <span class="o">==</span> <span class="n">node_right_plus</span><span class="p">:</span>
                <span class="c1"># Ports 1 and 2 are the wrong way round, minuses cancel out</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">node_left_minus</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">node_right_minus</span>
                <span class="n">gr</span> <span class="o">=</span> <span class="n">node_left_plus</span> <span class="c1">#= node_right_plus</span>

                <span class="c1"># Y_1 = ntr.branch_admittance(p1,gr)</span>
                <span class="n">Y_2</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">gr</span><span class="p">)</span>
                <span class="n">Y_3</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>

                <span class="c1"># A component of the ABCD matrix</span>
                <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">Y_2</span><span class="o">/</span><span class="n">Y_3</span> <span class="c1"># node Y_3 cannot be 0 in theory</span>
                <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">A</span>

            <span class="k">elif</span> <span class="n">node_left_minus</span> <span class="o">==</span> <span class="n">node_right_plus</span><span class="p">:</span>
                <span class="c1"># Port 2 is the wrong way round, transfer function gets a minus</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">node_left_plus</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">node_right_minus</span>
                <span class="n">gr</span> <span class="o">=</span> <span class="n">node_left_minus</span> <span class="c1">#= node_right_plus</span>
                <span class="c1"># Y_1 = ntr.branch_admittance(p1,gr)</span>
                <span class="n">Y_2</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">gr</span><span class="p">)</span>
                <span class="n">Y_3</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>

                <span class="c1"># A component of the ABCD matrix</span>
                <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">Y_2</span><span class="o">/</span><span class="n">Y_3</span> <span class="c1"># node Y_3 cannot be 0 in theory</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">A</span>

            <span class="k">elif</span> <span class="n">node_left_plus</span> <span class="o">==</span> <span class="n">node_right_minus</span><span class="p">:</span>
                <span class="c1"># Port 2 is the wrong way round, transfer function gets a minus</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">node_left_minus</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">node_right_plus</span>
                <span class="n">gr</span> <span class="o">=</span> <span class="n">node_left_plus</span> <span class="c1">#= node_right_minus</span>
                <span class="c1"># Y_1 = ntr.branch_admittance(p1,gr)</span>
                <span class="n">Y_2</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">gr</span><span class="p">)</span>
                <span class="n">Y_3</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>

                <span class="c1"># A component of the ABCD matrix</span>
                <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">Y_2</span><span class="o">/</span><span class="n">Y_3</span> <span class="c1"># node Y_3 cannot be 0 in theory</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">A</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Most complex case (discussed in the paper)</span>
            <span class="c1"># First, compute the impence matrix of the lattice network following notations in </span>
            <span class="c1"># https://www.globalspec.com/reference/71734/203279/10-11-lattice-networks</span>
            <span class="c1"># excerpt of Network Analysis &amp; Circuit (By M. Arshad) section 10.11: LATTICE NETWORKS</span>
            <span class="n">Ya</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">node_left_plus</span><span class="p">,</span> <span class="n">node_right_plus</span><span class="p">)</span>
            <span class="n">Yb</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">node_left_minus</span><span class="p">,</span> <span class="n">node_right_plus</span><span class="p">)</span>
            <span class="n">Yc</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">node_left_plus</span><span class="p">,</span> <span class="n">node_right_minus</span><span class="p">)</span>
            <span class="n">Yd</span> <span class="o">=</span> <span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">node_left_minus</span><span class="p">,</span> <span class="n">node_right_minus</span><span class="p">)</span>

            <span class="c1"># The book provides formulas with impedance:</span>
            <span class="c1"># sum_Z = Za + Zb + Zc + Zd</span>
            <span class="c1"># Z11 is V1/I1 (with V2=0)</span>
            <span class="c1"># Z11 = (Za+Zb)*(Zd+Zc)/sum_Z</span>
            <span class="c1"># Z21 is V1/I2 (with V2=0)</span>
            <span class="c1"># Z21 = (Zb*Zc-Za*Zd)/sum_Z</span>
            <span class="c1"># Z22 is V2/I2 (with V1=0)</span>
            <span class="c1"># Z22 = (Za+Zc)*(Zd+Zb)/sum_Z</span>

            <span class="c1"># From Pozar, we obtain the A and B components of the ABCD matrix of the lattice</span>
            <span class="c1"># The C and D components play no role in determining the transfer function</span>
            <span class="c1"># A_lattice = Z11/Z21</span>
            <span class="c1"># B_lattice = Z11*Z22/Z21-Z21</span>

            <span class="c1"># We will work with admittances, to deal in an easier</span>
            <span class="c1"># way with Yx = 0 (otherwise we would have to </span>
            <span class="c1"># distinguish many more cases)</span>

            <span class="c1"># Using Mathematica, we compute simplify the expressions for </span>
            <span class="c1"># A_lattice and B_lattice to:</span>
            
            <span class="n">A_lattice</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ya</span> <span class="o">+</span> <span class="n">Yb</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Yd</span> <span class="o">+</span> <span class="n">Yc</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Ya</span><span class="o">*</span><span class="n">Yd</span><span class="o">-</span><span class="n">Yb</span><span class="o">*</span><span class="n">Yc</span><span class="p">)</span>
            <span class="n">B_lattice</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ya</span> <span class="o">+</span> <span class="n">Yb</span> <span class="o">+</span> <span class="n">Yc</span> <span class="o">+</span> <span class="n">Yd</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Ya</span><span class="o">*</span><span class="n">Yd</span><span class="o">-</span><span class="n">Yb</span><span class="o">*</span><span class="n">Yc</span><span class="p">)</span>

            <span class="c1"># The admittance accross the left port plays no role</span>
            <span class="c1"># The admittance accross the right port comes into play to yield the A component</span>
            <span class="c1"># of the total ABCD matrix:</span>

            <span class="n">A</span> <span class="o">=</span> <span class="n">A_lattice</span> <span class="o">+</span> <span class="n">B_lattice</span><span class="o">*</span><span class="n">ntr</span><span class="o">.</span><span class="n">branch_admittance</span><span class="p">(</span><span class="n">node_right_minus</span><span class="p">,</span><span class="n">node_right_plus</span><span class="p">)</span>

            <span class="k">return</span>  <span class="mi">1</span><span class="o">/</span><span class="n">A</span>

<span class="k">class</span> <span class="nc">Circuit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for Circuit&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_minus</span> <span class="o">=</span> <span class="n">node_minus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_plus</span> <span class="o">=</span> <span class="n">node_plus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_circuit</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_circuit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_plot_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_minus</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_minus_plot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_plus</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_plus_plot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_minus</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_minus_plot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_plus</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_plus_plot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_minus</span> <span class="o">+</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_plus</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_minus</span> <span class="o">+</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_plus</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_minus</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_plus</span><span class="p">:</span>
            <span class="c1"># increasing y = SOUTH in tkinter</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_minus</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_plus</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">SOUTH</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">NORTH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_minus</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_plus</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">WEST</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">EAST</span>

    <span class="k">def</span> <span class="nf">draw_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;text_position_horizontal&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;text_position_horizontal&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
            <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;text_position_vertical&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;text_position_vertical&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;fontsize&#39;</span><span class="p">],</span>
                <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Parallel</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Parallel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node_plus</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># sets the two children circuit elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>

    <span class="k">def</span> <span class="nf">admittance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Add</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">admittance</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">admittance</span><span class="p">())</span>
    
    <span class="k">def</span> <span class="nf">get_RLC_matrix_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">RLC_matrix_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">]:</span>
            <span class="n">values_to_add</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get_RLC_matrix_components</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">RLC_matrix_components</span><span class="p">:</span>
                <span class="n">RLC_matrix_components</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values_to_add</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">RLC_matrix_components</span>

<span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for Component&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flux</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">arg1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arg2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Specify either a value or a label&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">a</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_component_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">:</span>
                <span class="c1"># raise ValueError(</span>
                <span class="c1">#     &quot;Two components may not have the same name %s&quot; % self.label)</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">no_value_components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flux</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">flux_transformation_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">node_plus</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">ref_elt</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">ref_elt</span><span class="o">.</span><span class="n">node_plus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_plus</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">flux_transformation_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_minus</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">node_plus</span><span class="p">]</span> <span class="o">=</span> <span class="n">tr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">flux_transformation_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_plus</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">node_minus</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tr</span>

            <span class="n">_flux_undecorated</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">no_value_components</span><span class="p">,</span>
                <span class="n">tr</span><span class="o">*</span><span class="n">sp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hbar</span><span class="o">/</span><span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">dY_analytical</span><span class="p">),</span> 
                <span class="s2">&quot;numpy&quot;</span><span class="p">)</span>

            <span class="nd">@safely_evaluate</span>
            <span class="k">def</span> <span class="nf">_flux_single</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_flux_undecorated</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="k">def</span> <span class="nf">_flux</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="c1"># test if w is an iterable</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">iter</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c1"># iterable = False</span>
                    <span class="k">return</span> <span class="n">_flux_single</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># iterable = True</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_flux_single</span><span class="p">(</span><span class="n">w_single</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">w_single</span> <span class="ow">in</span> <span class="n">w</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_flux</span> <span class="o">=</span> <span class="n">_flux</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flux</span>

    <span class="k">def</span> <span class="nf">voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">w</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">admittance</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="n">subs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">/</span><span class="n">w</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_math</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_unicode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                  <span class="n">use_math</span><span class="o">=</span><span class="n">use_math</span><span class="p">,</span> <span class="n">use_unicode</span><span class="o">=</span><span class="n">use_unicode</span><span class="p">)</span>

<div class="viewcode-block" id="W"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.W">[docs]</a><span class="k">class</span> <span class="nc">W</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for Wire&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="W.to_string"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.W.to_string">[docs]</a>    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span></div>

<div class="viewcode-block" id="W.set_component_lists"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.W.set_component_lists">[docs]</a>    <span class="k">def</span> <span class="nf">set_component_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_component_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">wires</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="W.draw"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.W.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_plus</span><span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_minus</span><span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plot_node_plus</span><span class="p">])]</span>

        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_plus</span><span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_minus</span><span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plot_node_plus</span><span class="p">])]</span>

        <span class="n">line_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span>
        <span class="n">line_type</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>
        <span class="n">line_type</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">line_type</span></div></div>

<div class="viewcode-block" id="G"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.G">[docs]</a><span class="k">class</span> <span class="nc">G</span><span class="p">(</span><span class="n">W</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    From a network perspective, a ground element is a wire that connects</span>
<span class="sd">    node_plus to a node called &#39;__ground&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>

<div class="viewcode-block" id="G.set_component_lists"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.G.set_component_lists">[docs]</a>    <span class="k">def</span> <span class="nf">set_component_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_component_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">grounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="G.draw"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.G.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Defined for EAST</span>
        <span class="n">line_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">]),</span>
        <span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span><span class="o">*</span><span class="mf">5.</span><span class="o">/</span><span class="mf">30.</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span><span class="o">*</span><span class="mf">3.</span><span class="o">/</span><span class="mf">30.</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="mf">30.</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">==</span> <span class="n">WEST</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">==</span> <span class="n">NORTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">([</span><span class="o">-</span><span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">==</span> <span class="n">EAST</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">([</span><span class="o">-</span><span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">==</span> <span class="n">SOUTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span></div></div>

<div class="viewcode-block" id="L"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.L">[docs]</a><span class="k">class</span> <span class="nc">L</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>

<div class="viewcode-block" id="L.admittance"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.L.admittance">[docs]</a>    <span class="k">def</span> <span class="nf">admittance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sp</span><span class="o">.</span><span class="n">I</span><span class="o">*</span><span class="n">Mul</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span></div>

<div class="viewcode-block" id="L.set_component_lists"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.L.set_component_lists">[docs]</a>    <span class="k">def</span> <span class="nf">set_component_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_component_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">inductors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="L.draw"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.L.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="s1">&#39;N_turns&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="s1">&#39;N_points&#39;</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">x</span>

        <span class="n">line_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>

        <span class="c1"># reset leftmost point to 0</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">-=</span> <span class="n">x_min</span>

        <span class="c1"># set width inductor width</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x_max</span>

        <span class="c1"># set leftmost point to the length of</span>
        <span class="c1"># the side connection wires</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>

        <span class="c1"># add side wire connections</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">x_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">x_min</span><span class="p">])]</span>
        <span class="n">x_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_max</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])]</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>

        <span class="c1"># center in x</span>
        <span class="n">x_list</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

        <span class="c1"># set height of inductor</span>
        <span class="n">y</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span>

        <span class="c1"># add side wire connections</span>
        <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">y_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])]</span>
        <span class="n">y_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">y_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">y_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span></div>

<div class="viewcode-block" id="L.get_RLC_matrix_components"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.L.get_RLC_matrix_components">[docs]</a>    <span class="k">def</span> <span class="nf">get_RLC_matrix_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">}</span></div></div>

<span class="k">class</span> <span class="nc">J</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_E</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_I</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">use_E</span> <span class="o">=</span> <span class="n">use_E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_I</span> <span class="o">=</span> <span class="n">use_I</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_E</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;Hz&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_I</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_E</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_I</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_E</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_I</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">hbar</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">value</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>  <span class="c1"># E is assumed to be provided in Hz</span>
            <span class="k">return</span> <span class="n">L</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">use_E</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">use_I</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">hbar</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="n">value</span>
            <span class="k">return</span> <span class="n">L</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot set both use_E and use_I to True&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_component_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_component_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">junctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">anharmonicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="n">hbar</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">line_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                      <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                      <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span>
        <span class="p">]</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">)</span>

        <span class="c1"># center in x and y</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>

<div class="viewcode-block" id="R"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.R">[docs]</a><span class="k">class</span> <span class="nc">R</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\Omega$&#39;</span>

<div class="viewcode-block" id="R.admittance"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.R.admittance">[docs]</a>    <span class="k">def</span> <span class="nf">admittance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span></div>

<div class="viewcode-block" id="R.set_component_lists"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.R.set_component_lists">[docs]</a>    <span class="k">def</span> <span class="nf">set_component_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_component_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">resistors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
<div class="viewcode-block" id="R.get_RLC_matrix_components"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.R.get_RLC_matrix_components">[docs]</a>    <span class="k">def</span> <span class="nf">get_RLC_matrix_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
            <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">}</span></div>
<div class="viewcode-block" id="R.draw"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.R.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">+</span>
                        <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="s1">&#39;N_ridges&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="s1">&#39;N_points&#39;</span><span class="p">])</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">period</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">height</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">period</span><span class="p">),</span> <span class="mf">2.</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">height</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">period</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">period</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">period</span><span class="p">))</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">height</span>

        <span class="n">line_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>

        <span class="c1"># reset leftmost point to 0</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">-=</span> <span class="n">x_min</span>

        <span class="c1"># set width inductor width</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x_max</span>

        <span class="c1"># set leftmost point to the length of</span>
        <span class="c1"># the side connection wires</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>

        <span class="c1"># add side wire connections</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">x_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">x_min</span><span class="p">])]</span>
        <span class="n">x_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_max</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])]</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>

        <span class="c1"># center in x</span>
        <span class="n">x_list</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

        <span class="c1"># set height of inductor</span>
        <span class="n">y</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span>

        <span class="c1"># add side wire connections</span>
        <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">y_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])]</span>
        <span class="n">y_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">y_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">y_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span></div></div>

<div class="viewcode-block" id="C"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.C">[docs]</a><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>

<div class="viewcode-block" id="C.admittance"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.C.admittance">[docs]</a>    <span class="k">def</span> <span class="nf">admittance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">I</span><span class="o">*</span><span class="n">Mul</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span></div>

<div class="viewcode-block" id="C.set_component_lists"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.C.set_component_lists">[docs]</a>    <span class="k">def</span> <span class="nf">set_component_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_component_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">capacitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="C.draw"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.C.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;gap&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;gap&#39;</span><span class="p">])</span> <span class="o">/</span>
                      <span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;gap&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                      <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;gap&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;gap&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                      <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;gap&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">]),</span>
        <span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">]),</span>
        <span class="p">]</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
        <span class="n">line_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>

        <span class="c1"># center in x and y</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">%</span><span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plot_center</span><span class="p">),</span> <span class="n">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plot_center</span><span class="p">),</span> <span class="n">line_type</span></div>

<div class="viewcode-block" id="C.get_RLC_matrix_components"><a class="viewcode-back" href="../../../API/components.html#Qcircuits.C.get_RLC_matrix_components">[docs]</a>    <span class="k">def</span> <span class="nf">get_RLC_matrix_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="p">}</span></div></div>

<span class="k">class</span> <span class="nc">Admittance</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_minus</span> <span class="o">=</span> <span class="n">node_minus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_plus</span> <span class="o">=</span> <span class="n">node_plus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>

    <span class="k">def</span> <span class="nf">admittance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span>

<span class="nd">@timeit</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Network</span><span class="p">([</span>
            <span class="n">C</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">),</span>
            <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">),</span>
            <span class="n">J</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">),</span>
            <span class="n">J</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">),</span>
            <span class="n">J</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">),</span>
            <span class="n">J</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="c1"># circuit = GUI(filename = &#39;.txt&#39;,edit=False,plot=False)</span>
    <span class="c1"># print(circuit.Y)</span>
    <span class="c1"># print(sp.together(circuit.Y))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">w_k_A_chi</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1e-13</span><span class="p">,</span><span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
    <span class="c1"># circuit.show_normal_mode(0)</span>
    <span class="c1"># circuit.show_normal_mode(1)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Mario Gely

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>