

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Qcircuits.gui &mdash; Qcircuits  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Qcircuits
          

          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../API.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Qcircuits</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>Qcircuits.gui</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Qcircuits.gui</h1><div class="highlight"><pre>
<span></span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># Tkinter for Python 2.xx</span>
    <span class="kn">import</span> <span class="nn">Tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
    <span class="kn">from</span> <span class="nn">tkFont</span> <span class="k">import</span> <span class="n">Font</span>
    <span class="kn">from</span> <span class="nn">Tkinter</span> <span class="k">import</span> <span class="n">tkMessageBox</span> <span class="k">as</span> <span class="n">messagebox</span>
    <span class="kn">from</span> <span class="nn">Tkinter</span> <span class="k">import</span> <span class="n">tkFileDialog</span> <span class="k">as</span> <span class="n">filedialog</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># Tkinter for Python 3.xx</span>
    <span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
    <span class="kn">from</span> <span class="nn">tkinter.font</span> <span class="k">import</span> <span class="n">Font</span>
    <span class="kn">from</span> <span class="nn">tkinter</span> <span class="k">import</span> <span class="n">messagebox</span><span class="p">,</span><span class="n">filedialog</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="k">import</span> <span class="n">ttk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">Qcircuits.utility</span> <span class="k">import</span> <span class="n">to_string</span>
<span class="kn">from</span> <span class="nn">Qcircuits.constants</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>

<span class="n">png_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;.graphics&quot;</span><span class="p">)</span>
<span class="n">node_dot_radius</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">30.</span>
<span class="n">lw</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">50.</span>
<span class="n">lw_hover</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">lw</span>
<span class="n">lw_select_hover</span> <span class="o">=</span> <span class="mf">5.</span><span class="o">*</span><span class="n">lw</span>
<span class="n">lw_select</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">lw</span>


<span class="k">def</span> <span class="nf">string_to_component</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">W</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">L</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">J</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">C</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">G</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>


<div class="viewcode-block" id="AutoScrollbar"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.AutoScrollbar">[docs]</a><span class="k">class</span> <span class="nc">AutoScrollbar</span><span class="p">(</span><span class="n">ttk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">):</span>

<div class="viewcode-block" id="AutoScrollbar.set"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.AutoScrollbar.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">):</span>
        <span class="c1"># uncomment for auto-hiding scroll bars</span>
        <span class="c1"># if float(lo) &lt;= 0.0 and float(hi) &gt;= 1.0:</span>
        <span class="c1">#     self.grid_remove()</span>
        <span class="c1"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">ttk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span></div>

<div class="viewcode-block" id="AutoScrollbar.pack"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.AutoScrollbar.pack">[docs]</a>    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">tk</span><span class="o">.</span><span class="n">TclError</span><span class="p">(</span>
            <span class="s1">&#39;Cannot use pack with the widget &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="AutoScrollbar.place"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.AutoScrollbar.place">[docs]</a>    <span class="k">def</span> <span class="nf">place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">tk</span><span class="o">.</span><span class="n">TclError</span><span class="p">(</span>
            <span class="s1">&#39;Cannot use place with the widget &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SnappingCanvas"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas">[docs]</a><span class="k">class</span> <span class="nc">SnappingCanvas</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">grid_unit</span><span class="p">,</span> <span class="n">netlist_filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the ImageFrame &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">netlist_filename</span> <span class="o">=</span> <span class="n">netlist_filename</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        In the netlist file is stored at all times </span>
<span class="sd">        (except whilst drag/dropping elements)</span>
<span class="sd">        all the information necessary to re-construct </span>
<span class="sd">        the circuit as the user sees it</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets the size, in pixels of the </span>
        <span class="c1"># grid initially displayed upon opening </span>
        <span class="c1"># the editor. This variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_unit</span><span class="p">)</span>

        <span class="c1"># List which stores all the circuit elements </span>
        <span class="c1"># currently placed on the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># in_creation is None if no element is being created.</span>
        <span class="c1"># It is equal to a circuit element if that </span>
        <span class="c1"># particular element is under creation.</span>
        <span class="c1"># This allows us to handle zooming in/out </span>
        <span class="c1"># during the creation of a component</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_creation</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># When elements are copied (or cut), </span>
        <span class="c1"># deepcopies of these elements are made and</span>
        <span class="c1"># they are stored without being displayed </span>
        <span class="c1"># in this list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copied_elements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Everytime the user makes a change to the circuit, </span>
        <span class="c1"># this list is appended with the self.elements variable</span>
        <span class="c1"># hence allowing us to undo an arbitrary number of user actions </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Informs us of what index of the self.history variable</span>
        <span class="c1"># the current circuit seen on the canvas corresponds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># We can cancel the appending of changes to the self.history</span>
        <span class="c1"># variable as well as the saving of changes to the netlist file</span>
        <span class="c1"># by setting this variable to True.</span>
        <span class="c1"># This is useful for example </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">netlist_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">netlist_file_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">netlist_file_string</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">netlist_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">build_gridframe</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_menubar</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_scrollbars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_canvas</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_scrollbars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_canvas_center</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_canvas</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">set_keyboard_shortcuts_element_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_keyboard_shortcuts_other</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">load_netlist</span><span class="p">(</span><span class="n">netlist_file_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_window_on_circuit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Keep track of what the user knows what to do</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_arrows</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Sets the &quot;active window&quot; in your OS, </span>
        <span class="c1"># the one towards which key strokes will be </span>
        <span class="c1"># directed to be this circuit editor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_set</span><span class="p">()</span>
        


<div class="viewcode-block" id="SnappingCanvas.build_menubar"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.build_menubar">[docs]</a>    <span class="k">def</span> <span class="nf">build_menubar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">master</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Builds the File, Edit, ... menu bar situated at the top of</span>
<span class="sd">        the window.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># initialize the menubar object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1">####################################</span>
        <span class="c1"># Define the label formatting</span>
        <span class="c1">####################################</span>

        <span class="c1"># File, Edit, ... are defined to have a width of 6 characters</span>
        <span class="n">menu_label_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:&lt;6}</span><span class="s2">&quot;</span>

        <span class="c1"># The items appearing in the cascade menu that appears when </span>
        <span class="c1"># clicking on File for example will have 15 characters width on the </span>
        <span class="c1"># left where the name of the functionality is provided and</span>
        <span class="c1"># 6 characters on the right where the keyboard shortcut is provided</span>
        <span class="n">label_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:&lt;15}{:&gt;6}</span><span class="s2">&quot;</span>

        <span class="c1"># The font for the cascading items is defined</span>
        <span class="c1"># Note: for everything to be aligned the chosen font should </span>
        <span class="c1"># have a constant character width, the only one satisfying this </span>
        <span class="c1"># condition is Courier new.</span>
        <span class="c1">#TODO use images as cascade menu items with an aligned and pretty font</span>
        <span class="n">menu_font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>

        <span class="c1">####################################</span>
        <span class="c1"># FILE cascade menu build</span>
        <span class="c1">####################################</span>

        <span class="c1"># add new item to the menubar</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">menu_label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">),</span> 
            <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">)</span>

        <span class="c1"># add cascade menu items</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+S&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="n">master</span><span class="o">.</span><span class="n">destroy</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>

        <span class="c1">####################################</span>
        <span class="c1"># EDIT cascade menu build</span>
        <span class="c1">####################################</span>

        <span class="c1"># add new item to the menubar</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">menu_label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Edit&quot;</span><span class="p">),</span> 
            <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">)</span>

        <span class="c1"># add cascade menu items</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Undo&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+Z&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_z</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Redo&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+Y&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_y</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Cut&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+X&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cut_selection</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Copy&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+C&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy_selection</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Paste&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+V&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;&lt;Control-v&gt;&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Select all&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+A&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">select_all</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span> <span class="s2">&quot;Del&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Delete all&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_all</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>


        <span class="c1">####################################</span>
        <span class="c1"># INSERT cascade menu build</span>
        <span class="c1">####################################</span>
        
        <span class="c1"># add new item to the menubar</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">menu_label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Insert&quot;</span><span class="p">),</span> 
            <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">)</span>

        <span class="c1"># add cascade menu items</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Wire&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Junction&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Inductor&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Capacitor&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Resistor&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Ground&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>

        
        <span class="c1">####################################</span>
        <span class="c1"># VIEW cascade menu build</span>
        <span class="c1">####################################</span>
        
        <span class="c1"># add new item to the menubar</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">menu_label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;View&quot;</span><span class="p">),</span> 
            <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">)</span>

        <span class="c1"># add cascade menu items</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Zoom in&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+scroll&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Zoom out&quot;</span><span class="p">,</span> <span class="s2">&quot;Ctrl+scroll&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">)),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Re-center&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> 
            <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_window_on_circuit</span><span class="p">),</span> 
            <span class="n">font</span><span class="o">=</span><span class="n">menu_font</span><span class="p">)</span>

        <span class="c1"># Add the menubar to the application</span>
        <span class="n">master</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="p">)</span></div>
<div class="viewcode-block" id="SnappingCanvas.build_gridframe"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.build_gridframe">[docs]</a>    <span class="k">def</span> <span class="nf">build_gridframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Builds the main area of the window (called a frame), </span>
<span class="sd">        which should stick to the edges of the window and </span>
<span class="sd">        expand as a user expands the window.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>  <span class="c1"># place Canvas widget on the grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">sticky</span><span class="o">=</span><span class="s1">&#39;nswe&#39;</span><span class="p">)</span>  <span class="c1"># make frame container sticky</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># make canvas expandable in x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># make canvas expandable in y</span></div>
<div class="viewcode-block" id="SnappingCanvas.build_scrollbars"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.build_scrollbars">[docs]</a>    <span class="k">def</span> <span class="nf">build_scrollbars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Builds horizontal and vertical scrollbars and places</span>
<span class="sd">        them in the window</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># Vertical and horizontal scrollbars for canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbar</span> <span class="o">=</span> <span class="n">AutoScrollbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbar</span> <span class="o">=</span> <span class="n">AutoScrollbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbar</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s1">&#39;we&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbar</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s1">&#39;ns&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="SnappingCanvas.build_canvas"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.build_canvas">[docs]</a>    <span class="k">def</span> <span class="nf">build_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initializes the canvas from which this object inherits and </span>
<span class="sd">        places it in the grid of our window</span>

<span class="sd">        Actually in the previously called build_* functions, we have</span>
<span class="sd">        defined frames, menubars, etc.. which are seperate from the canvas.</span>
<span class="sd">        It is however convinient to do so since most of these definied buttons</span>
<span class="sd">        or scrollbars will be acting on the canvas itself.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> 
            <span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">xscrollcommand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hbar</span><span class="o">.</span><span class="n">set</span><span class="p">,</span> 
            <span class="n">yscrollcommand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vbar</span><span class="o">.</span><span class="n">set</span><span class="p">,</span> 
            <span class="n">confine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s1">&#39;nswe&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="SnappingCanvas.configure_scrollbars"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.configure_scrollbars">[docs]</a>    <span class="k">def</span> <span class="nf">configure_scrollbars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define what functions the scrollbars should call</span>
<span class="sd">        when we interact with them.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbar</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span><span class="p">)</span>  <span class="c1"># bind scrollbars to the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbar</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span><span class="p">)</span></div>
<div class="viewcode-block" id="SnappingCanvas.set_canvas_center"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.set_canvas_center">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas_center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the center of the canvas in </span>
<span class="sd">        canvas coordinates. This information is necessary to </span>
<span class="sd">        convert grid units to canvas units</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Wait for the canvas to pop up before asking </span>
        <span class="c1"># for its window size below</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  

        <span class="c1"># winfo_width/height gives the </span>
        <span class="c1"># width/height of the window in window units</span>
        <span class="c1"># canvasx/y converts window units to </span>
        <span class="c1"># canvas units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span></div>
<div class="viewcode-block" id="SnappingCanvas.configure_canvas"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.configure_canvas">[docs]</a>    <span class="k">def</span> <span class="nf">configure_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ensure that the function &quot;on_resize&quot;</span>
<span class="sd">        is called each time the user resizes</span>
<span class="sd">        the window. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Configure&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_resize</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">set_keyboard_shortcuts_element_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">R</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">L</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">C</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">J</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">G</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">set_keyboard_shortcuts_other</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1">#############################</span>
        <span class="c1"># FILE menu functionalities</span>
        <span class="c1">#############################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-s&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Delete&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-c&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_selection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-x&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_selection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-v&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paste</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-a&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_all</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-y&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-z&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_z</span><span class="p">)</span>
        <span class="c1"># zoom for Windows and MacOS, but not Linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-MouseWheel&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Linux, wheel scroll down</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-Button-5&gt;&#39;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Linux, wheel scroll up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-Button-4&gt;&#39;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Windows and MacOS, but not Linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Shift-MouseWheel&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x_wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Linux, wheel scroll down</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Shift-Button-5&gt;&#39;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x_wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Linux, wheel scroll up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Shift-Button-4&gt;&#39;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x_wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Windows and MacOS, but not Linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;MouseWheel&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y_wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Linux, wheel scroll down</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Button-5&gt;&#39;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y_wheel</span><span class="p">)</span>
        <span class="c1"># zoom for Linux, wheel scroll up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Button-4&gt;&#39;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y_wheel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">netlist_filename</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">netlist_filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># User cancelled</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">netlist_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">netlist_file_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_netlist</span><span class="p">(</span><span class="n">netlist_file_string</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading file failed with error:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
            
    <span class="k">def</span> <span class="nf">get_mouse_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_pointerx</span><span class="p">())</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_rootx</span><span class="p">(),</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_pointery</span><span class="p">())</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_rooty</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">cut_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copied_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">selected</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copied_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">to_paste</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copied_elements</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># smallest x and y of copied elements, in canvas units</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">x_minus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">to_paste</span><span class="p">]</span> <span class="o">+</span>
                        <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">x_plus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">to_paste</span><span class="p">])</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">y_minus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">to_paste</span><span class="p">]</span> <span class="o">+</span>
                        <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">y_plus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">to_paste</span><span class="p">])</span>
            <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">])</span>

            <span class="c1"># shift to apply, in canvas units</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">x_min</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">y_min</span>

            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">to_paste</span><span class="p">:</span>
                <span class="n">el</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
                <span class="n">el</span><span class="o">.</span><span class="n">adapt_to_grid_unit</span><span class="p">()</span>
                <span class="n">el</span><span class="o">.</span><span class="n">force_select</span><span class="p">()</span>
                <span class="n">el</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
                <span class="n">el</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Motion&gt;&quot;</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">on_motion</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_paste</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonPress-1&gt;&quot;</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">release_motion_paste_single</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Left&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">WEST</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Right&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">EAST</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Up&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">NORTH</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Down&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">SOUTH</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonPress-1&gt;&quot;</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">release_motion_paste</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copied_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">selected</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">center_window_on_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">x_minus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span> <span class="o">+</span> \
                <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">x_plus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">y_minus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span> <span class="o">+</span> \
                <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">y_plus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span>
            <span class="n">box_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>\
                    <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">scrollregion</span><span class="o">=</span><span class="n">box_elements</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xview_moveto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yview_moveto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configure_scrollregion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">scroll_y_wheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yview_scroll</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">UNITS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_scrollregion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">scroll_x_wheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xview_scroll</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">UNITS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_scrollregion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">configure_scrollregion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">extra_scrollable_region</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># in canvas units</span>
        <span class="n">box_canvas</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">extra_scrollable_region</span><span class="p">,</span>  <span class="c1"># get visible area of the canvas</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">extra_scrollable_region</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_width</span><span class="p">())</span><span class="o">+</span><span class="n">extra_scrollable_region</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">())</span><span class="o">+</span><span class="n">extra_scrollable_region</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">x_minus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span> <span class="o">+</span> \
                <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">x_plus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">y_minus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span> <span class="o">+</span> \
                <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">y_plus</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span>
            <span class="n">box_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
                <span class="n">scrollregion</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">box_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box_canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="n">box_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box_canvas</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                              <span class="nb">max</span><span class="p">(</span><span class="n">box_elements</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box_canvas</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">box_elements</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">box_canvas</span><span class="p">[</span><span class="mi">3</span><span class="p">])])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">scrollregion</span><span class="o">=</span><span class="n">box_canvas</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">old_grid_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span>
        
        <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1.08</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">:</span>
                <span class="c1"># Fast scrolling case on Windows</span>
                <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1.15</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">smallest_grid_unit</span> <span class="o">=</span> <span class="mi">35</span>
        <span class="n">largest_grid_unit</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="c1"># Respond to Linux (event.num) or Windows (event.delta) wheel event</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># scroll out, smaller</span>
            <span class="n">new_grid_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="o">/</span><span class="n">scaling</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_grid_unit</span> <span class="o">==</span> <span class="n">old_grid_unit</span><span class="p">:</span>
                <span class="n">new_grid_unit</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># scroll in, bigger</span>
            <span class="n">new_grid_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="o">*</span><span class="n">scaling</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_grid_unit</span> <span class="o">==</span> <span class="n">old_grid_unit</span><span class="p">:</span>
                <span class="n">new_grid_unit</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">smallest_grid_unit</span> <span class="o">&gt;</span> <span class="n">new_grid_unit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Can&#39;t zoom out more&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">new_grid_unit</span> <span class="o">&gt;</span> <span class="n">largest_grid_unit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Can&#39;t zoom in more&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_pos_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas_to_grid</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span> <span class="o">=</span> <span class="n">new_grid_unit</span>
            <span class="n">canvas_pos_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="n">grid_pos_old</span><span class="p">)</span>
            <span class="n">canvas_center_shift</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">canvas_pos_old</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">canvas_pos_old</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">canvas_center_shift</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">canvas_center_shift</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="n">el</span><span class="o">.</span><span class="n">adapt_to_grid_unit</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_creation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_creation</span><span class="o">.</span><span class="n">init_adapt_to_grid_unit</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configure_scrollregion</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;in&#39;</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;Control-MouseWheel&gt;&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="mi">121</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;out&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">121</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="SnappingCanvas.scroll_x"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.scroll_x">[docs]</a>    <span class="k">def</span> <span class="nf">scroll_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scroll canvas horizontally and redraw the image &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xview</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># scroll vertically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">()</span></div>

<div class="viewcode-block" id="SnappingCanvas.scroll_y"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.SnappingCanvas.scroll_y">[docs]</a>    <span class="k">def</span> <span class="nf">scroll_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scroll canvas vertically and redraw the image &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># scroll vertically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">ctrl_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># print(&#39;CTRL-Z&#39;)</span>
        <span class="c1"># for net in self.history:</span>
        <span class="c1">#     print(net)</span>
        <span class="c1"># print(&quot;location was: %d&quot; % self.history_location)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_location</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history_location</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_netlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">history_location</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Nothing to undo&#39;</span><span class="p">)</span>
        <span class="c1"># print(&quot;location is: %d&quot; % self.history_location)</span>

    <span class="k">def</span> <span class="nf">ctrl_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># print(&#39;CTRL-Y&#39;)</span>
        <span class="c1"># for net in self.history:</span>
        <span class="c1">#     print(net)</span>
        <span class="c1"># print(&quot;location was: %d&quot; % self.history_location)</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_location</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history_location</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_netlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">history_location</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Nothing to redo&#39;</span><span class="p">)</span>
        <span class="c1"># print(&quot;location is: %d&quot; % self.history_location)</span>

    <span class="k">def</span> <span class="nf">load_netlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_all</span><span class="p">(</span><span class="n">track_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
            <span class="n">string_to_component</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="n">el</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_scrollregion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Draw the grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">box_canvas</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># get visible area of the canvas</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_width</span><span class="p">()),</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
            <span class="o">*</span><span class="n">box_canvas</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">)</span>

        <span class="n">grid_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box_canvas</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">grid_x</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">,</span>
                            <span class="n">box_canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">grid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box_canvas</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">grid_y</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">,</span>
                            <span class="n">box_canvas</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">grid_x</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">grid_y</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">dy</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_lower</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;ButtonPress-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_selection_field</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s2">&quot;&lt;B1-Motion&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_selection_field</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s2">&quot;&lt;ButtonRelease-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_selection_field</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s2">&quot;&lt;Button-3&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_click</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease-3&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_right_click_menu</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_right_click_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Paste&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">event</span><span class="p">)))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">tk_popup</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease-3&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_selection_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle_x_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle_y_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">dash</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">expand_selection_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle_x_start</span><span class="p">),</span>
                    <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle_y_start</span><span class="p">),</span>
                    <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle_x_start</span><span class="p">),</span>
                    <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle_y_start</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">box_select</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">end_selection_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_rectangle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deselect_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">deselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">select_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">force_select</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">delete_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">track_changes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">was_tracking_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">selected</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">to_delete</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">track_changes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Just follow &quot;was_tracking_changes&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="n">was_tracking_changes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">track_changes</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="n">was_tracking_changes</span>
        <span class="k">elif</span> <span class="n">track_changes</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="n">track_changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_scrollregion</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">delete_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">track_changes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">track_changes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">netlist_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">v</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">prop</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">v</span>

            <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">netlist_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">;</span><span class="si">%s</span><span class="s2">;</span><span class="si">%s</span><span class="s2">;</span><span class="si">%s</span><span class="s2">;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">el</span><span class="o">.</span><span class="n">grid_to_node_string</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">y_minus</span><span class="p">),</span>
                <span class="n">el</span><span class="o">.</span><span class="n">grid_to_node_string</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">x_plus</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">y_plus</span><span class="p">),</span>
                <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netlist_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">netlist_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">history_location</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">netlist_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history_location</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># print(&#39;ADDED TO HISTORY&#39;)</span>
            <span class="c1"># for net in self.history:</span>
            <span class="c1">#     print(net)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Saving...&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">):</span>
        <span class="n">saved_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">Font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">t</span><span class="p">),</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">saved_message</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">create_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="c1"># Everything defined in canvas units</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">r</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">r</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">r</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">r</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circle</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="c1"># Everything defined in canvas units</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">r</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">r</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">r</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="c1"># pos = [x ,y] (in grid units)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="o">*</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="o">*</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">canvas_to_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="c1"># pos = [x ,y] (in canvas units)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">,</span>
                <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">]</span></div>

<span class="k">class</span> <span class="nc">TwoNodeElement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_moved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_rotated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">auto_place</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manual_place</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">auto_place</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">auto_place</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">auto_place</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_string_to_grid</span><span class="p">(</span>
                <span class="n">auto_place</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_string_to_grid</span><span class="p">(</span>
                <span class="n">auto_place</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auto_place</span><span class="p">(</span><span class="n">auto_place</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@pos</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@prop</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">newone</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">newone</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">newone</span>
        <span class="n">newone</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">newone</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newone</span>

    <span class="k">def</span> <span class="nf">abort_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rerun_command</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">in_creation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_keyboard_shortcuts_element_creation</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tk</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">KeyPress</span> <span class="ow">and</span> <span class="n">rerun_command</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">set_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">grid_to_node_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">node_string_to_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deselect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">force_select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">shift_control</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">shift_control</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">deselect_all</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Left&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">WEST</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Right&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">EAST</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Up&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">NORTH</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Down&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_updownleftright</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">SOUTH</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_center_pos</span><span class="p">()</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">selected</span> <span class="ow">or</span> <span class="n">el</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">el</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_moved</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">release_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">shift_control</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">N_selected</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">selected</span> <span class="ow">or</span> <span class="n">el</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">N_selected</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">el</span><span class="o">.</span><span class="n">snap_to_grid</span><span class="p">()</span>
                <span class="n">el</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_rotated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_nodes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">was_rotated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Left&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Right&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Up&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Down&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_moved</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force_select</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">was_moved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">shift_control</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_shift_select</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">release_motion_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release_motion</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Motion&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonPress-1&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">release_motion_paste_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release_motion_paste</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Left&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Right&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Up&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Down&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hover_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;Shift-Button-1&gt;&quot;</span><span class="p">,</span>
                             <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">shift_control</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;Control-Button-1&gt;&quot;</span><span class="p">,</span>
                             <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">shift_control</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span>
                             <span class="s2">&quot;&lt;B1-Motion&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_motion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;ButtonRelease-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_motion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s1">&#39;&lt;Double-Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;Shift-ButtonRelease-1&gt;&quot;</span><span class="p">,</span>
                             <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_motion</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">shift_control</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;Control-ButtonRelease-1&gt;&quot;</span><span class="p">,</span>
                             <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_motion</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">shift_control</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_allstate_bindings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_enter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span> <span class="s2">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_leave</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_object</span><span class="p">,</span>
                             <span class="s2">&quot;&lt;Button-3&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_click</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hover_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease-3&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_right_click_menu</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">deselect_all</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">ctrl_shift_select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">force_select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">deselect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="s1">&#39;all wires&#39;</span><span class="p">,</span> <span class="n">minus</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">plus</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Check if one of the nodes of this component/wire </span>
        <span class="c1"># is on a wire</span>
        <span class="k">if</span> <span class="n">to</span> <span class="o">==</span> <span class="s1">&#39;all wires&#39;</span><span class="p">:</span>
            <span class="n">to_nodify</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="n">W</span> <span class="ow">and</span> <span class="n">el</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">to_nodify</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_nodify</span> <span class="o">=</span> <span class="n">to</span>
        
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">to_nodify</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">==</span> <span class="n">w</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="ow">and</span> <span class="n">minus</span><span class="p">:</span>
                <span class="c1"># vertical wire, minus node</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">y_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">y_plus</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">y_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">y_plus</span><span class="p">)):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">x_minus</span>
                    <span class="n">ym</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">y_minus</span>
                    <span class="n">yp</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">y_plus</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ym</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yp</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="k">return</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">w</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">==</span> <span class="n">w</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="ow">and</span> <span class="n">minus</span><span class="p">:</span>
                <span class="c1"># horizontal wire, minus node</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">x_plus</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">x_plus</span><span class="p">)):</span>
                    <span class="n">xm</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">x_minus</span>
                    <span class="n">xp</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">x_plus</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">y_minus</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">w</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">==</span> <span class="n">w</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="ow">and</span> <span class="n">plus</span><span class="p">:</span>
                <span class="c1"># vertical wire, positive node</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">y_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">y_plus</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">y_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">y_plus</span><span class="p">)):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">x_minus</span>
                    <span class="n">ym</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">y_minus</span>
                    <span class="n">yp</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">y_plus</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ym</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yp</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="k">return</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">w</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">==</span> <span class="n">w</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="ow">and</span> <span class="n">plus</span><span class="p">:</span>
                <span class="c1"># horizontal wire, positive node</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">x_plus</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="n">w</span><span class="o">.</span><span class="n">x_plus</span><span class="p">)):</span>
                    <span class="n">xm</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">x_minus</span>
                    <span class="n">xp</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">x_plus</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">y_minus</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="n">W</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">auto_place</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">add_or_replace_node_dots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plus</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">minus</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span>
        <span class="n">canvas_coords_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">minus</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_circle</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">canvas_coords_minus</span><span class="p">,</span> <span class="n">gu</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">update_circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">canvas_coords_minus</span><span class="p">,</span> <span class="n">gu</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plus</span><span class="p">:</span>
            <span class="n">canvas_coords_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_circle</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">canvas_coords_plus</span><span class="p">,</span> <span class="n">gu</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">update_circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">canvas_coords_plus</span><span class="p">,</span> <span class="n">gu</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">W</span><span class="p">(</span><span class="n">TwoNodeElement</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">auto_place</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">binding_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">]</span>

    <span class="nd">@pos</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="nd">@prop</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">to</span> <span class="o">=</span> <span class="s1">&#39;all wires&#39;</span><span class="p">):</span>

        <span class="n">all_other_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span> <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">all_other_elements</span><span class="p">:</span>
            <span class="n">added_a_node</span> <span class="o">=</span> <span class="n">TwoNodeElement</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">to</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">added_a_node</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="n">added_a_node</span> <span class="o">=</span> <span class="n">TwoNodeElement</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">to</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">added_a_node</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">box_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">]</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
        <span class="n">xm</span><span class="p">,</span><span class="n">ym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">])</span>
        <span class="n">xp</span><span class="p">,</span><span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">xm</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">ym</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>\
                <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">xp</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">yp</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force_select</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_center_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># returns center in canvas units</span>
        <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">xm</span><span class="o">+</span><span class="n">xp</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="p">(</span><span class="n">ym</span><span class="o">+</span><span class="n">yp</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">open_right_click_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Copy&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cut&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">cut_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">tk_popup</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease-3&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">double_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">snap_to_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># in canvas coordinates</span>
        <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
        <span class="c1"># snapped to grid units</span>
        <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvas_to_grid</span><span class="p">(</span>
            <span class="p">[</span><span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvas_to_grid</span><span class="p">([</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">]</span>

        <span class="c1"># back to canvas units:</span>
        <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span>
            <span class="p">[</span><span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">update_circle</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">update_circle</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">)</span>

        <span class="c1"># Add node if a node of this line is on another line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_minus_snap_to_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvas_center</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">)),</span>\
            <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">init_plus_snap_to_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">])</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvas_center</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xm</span><span class="o">-</span><span class="n">xp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ym</span><span class="o">-</span><span class="n">yp</span><span class="p">):</span>
            <span class="c1"># Horizontal line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Vertical line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">end_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Motion&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="s1">&#39;arrow&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_plus_snap_to_grid</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_keyboard_shortcuts_element_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">in_creation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Input given in canvas units</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_or_replace_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_graphic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">blue</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">lw_select_hover</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">light_blue</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">lw_select</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">light_black</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">lw_hover</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">light_black</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">lw</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_updownleftright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">manual_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="s1">&#39;plus&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Escape&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">rerun_command</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">auto_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_place_info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_minus_snap_to_grid</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="n">gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_circle</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">])),</span> <span class="n">gu</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Motion&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">in_creation</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">abort_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rerun_command</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Escape&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="s1">&#39;arrow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># First node has been created</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Motion&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">W</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">rerun_command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">canvas_coords_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">canvas_coords_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span><span class="n">canvas_coords_minus</span><span class="o">+</span><span class="n">canvas_coords_plus</span><span class="p">),</span>
            <span class="n">width</span><span class="o">=</span><span class="n">lw</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">,</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="n">light_black</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_allstate_bindings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">adapt_to_grid_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">canvas_coords_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">canvas_coords_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">canvas_coords_minus</span><span class="o">+</span><span class="n">canvas_coords_plus</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_adapt_to_grid_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_line</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">(</span><span class="n">plus</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">)</span>

        <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">])</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xm</span><span class="o">-</span><span class="n">xp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ym</span><span class="o">-</span><span class="n">yp</span><span class="p">):</span>
            <span class="c1"># Horizontal line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">lw</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">,</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="n">light_black</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Vertical line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">lw</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">,</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="n">light_black</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="n">TwoNodeElement</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_center</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_center</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">auto_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_center_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># returns center in canvas units</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">binding_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span><span class="p">]</span>

    <span class="nd">@pos</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="c1"># Defined in grid units, _x/y_center should be n+(0. or 0.5) with n an integer</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_center</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_center</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_nodes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">]</span>

    <span class="nd">@prop</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># positive y points south</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span> <span class="o">==</span> <span class="n">SOUTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span> <span class="o">==</span> <span class="n">NORTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span> <span class="o">==</span> <span class="n">EAST</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span> <span class="o">==</span> <span class="n">WEST</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">box_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">]</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_center_pos</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force_select</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">manual_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_create_component</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">in_creation</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">auto_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_place_info</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">:</span>
            <span class="c1"># increasing y = SOUTH in tkinter</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">SOUTH</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">NORTH</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_plus</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">,</span> <span class="n">EAST</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_minus</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">x_plus</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_minus</span><span class="p">,</span> <span class="n">WEST</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">request_value_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">RequestValueLabelWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">master</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">wait_window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">png</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover</span><span class="p">:</span>
            <span class="n">png</span> <span class="o">+=</span> <span class="s1">&#39;_hover&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span><span class="p">:</span>
            <span class="n">png</span> <span class="o">+=</span> <span class="s1">&#39;_selected&#39;</span>
        <span class="n">png</span> <span class="o">+=</span> <span class="s1">&#39;.png&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_angle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">png_directory</span><span class="p">,</span> <span class="n">png</span><span class="p">))</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">node_dot_radius</span><span class="p">))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">expand</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tk_image</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_image</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]),</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tk_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_allstate_bindings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_graphic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_image</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tk_image</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">adapt_to_grid_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">init_adapt_to_grid_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">double_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modify_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">modify_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">old_prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_value_label</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">old_prop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">and</span>  <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">used_arrows</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Use arrows to rotate&quot;</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">used_arrows</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_angle</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_image</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tk_image</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Motion&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_on_motion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Escape&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">rerun_command</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Left&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_create_component</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">WEST</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Right&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_create_component</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">EAST</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Up&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_create_component</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">NORTH</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s1">&#39;&lt;Down&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_create_component</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">SOUTH</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">unset_initialization_bindings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Motion&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Left&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Right&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Up&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Down&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Escape&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">abort_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rerun_command</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unset_initialization_bindings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">rerun_command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unset_initialization_bindings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_to_grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_keyboard_shortcuts_element_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_value_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">in_creation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort_creation</span><span class="p">(</span><span class="n">rerun_command</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_allstate_bindings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">track_changes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># If mouse is still on top of component,</span>
        <span class="c1"># act as if one had hovered on top of component</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_mouse_location</span><span class="p">()</span>

        <span class="c1"># bounding box of image</span>
        <span class="n">xm</span><span class="p">,</span><span class="n">ym</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xm</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&lt;</span><span class="n">xp</span> <span class="ow">and</span> <span class="n">ym</span><span class="o">&lt;</span><span class="n">y</span><span class="o">&lt;</span><span class="n">yp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hover_enter</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_right_click_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Edit&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modify_values</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Copy&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cut&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">cut_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">tk_popup</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease-3&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                        <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mf">90.</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                        <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mf">90.</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">()</span>
                
    <span class="k">def</span> <span class="nf">init_on_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Input given in canvas units</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_updownleftright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">used_arrows</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_angle</span> <span class="o">=</span> <span class="n">angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_graphic</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_label</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">was_rotated</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_minus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_plus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">add_or_replace_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">value</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                         <span class="n">use_math</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gu</span><span class="o">/</span><span class="mf">8.</span><span class="p">),</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">text_position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">)</span><span class="o">*</span><span class="n">gu</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span>
                <span class="n">x</span><span class="o">+</span><span class="n">text_position</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">angle</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">text_position</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                   <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">angle</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">text_position</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">angle</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">text_position</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                   <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">snap_to_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">canvas_center</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid_unit</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_angle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">angle</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">),</span>
                <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="o">-</span><span class="n">gu</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="n">angle</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">angle</span> <span class="o">%</span> <span class="mf">180.</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mf">0.5</span> <span class="o">+</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="o">-</span><span class="n">gu</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">),</span>
                <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="n">gu</span><span class="p">),</span>
                <span class="n">angle</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_to_canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>

        <span class="c1"># Add nodes in case of intersection with a wire</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">()</span>

        <span class="c1"># Add circles at the nodes of the component</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">()</span>

<div class="viewcode-block" id="R"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.R">[docs]</a><span class="k">class</span> <span class="nc">R</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for R&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\Omega$&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">auto_place</span><span class="p">)</span></div>


<div class="viewcode-block" id="L"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.L">[docs]</a><span class="k">class</span> <span class="nc">L</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for L&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">auto_place</span><span class="p">)</span></div>


<div class="viewcode-block" id="C"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.C">[docs]</a><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for C&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">auto_place</span><span class="p">)</span></div>


<div class="viewcode-block" id="J"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.J">[docs]</a><span class="k">class</span> <span class="nc">J</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for J&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">auto_place</span><span class="p">)</span></div>


<div class="viewcode-block" id="G"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.G">[docs]</a><span class="k">class</span> <span class="nc">G</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for J&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_place</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">auto_place</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

    <span class="nd">@prop</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">double_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">request_value_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">open_right_click_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Copy&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cut&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">cut_selection</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">tk_popup</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease-3&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_or_replace_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">add_or_replace_node_dots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add_or_replace_node_dots</span><span class="p">(</span><span class="n">minus</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="s1">&#39;all wires&#39;</span><span class="p">,</span> <span class="n">minus</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plus</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>   
        <span class="nb">super</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">to</span> <span class="o">=</span> <span class="n">to</span><span class="p">,</span> <span class="n">minus</span> <span class="o">=</span> <span class="n">minus</span><span class="p">,</span> <span class="n">plus</span> <span class="o">=</span> <span class="n">plus</span><span class="p">)</span>       </div>

<div class="viewcode-block" id="RequestValueLabelWindow"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.RequestValueLabelWindow">[docs]</a><span class="k">class</span> <span class="nc">RequestValueLabelWindow</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">component</span>

        <span class="c1"># TODO add suggestions</span>
        <span class="c1"># TODO inform that filling two fields is optional</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;Label&#39;</span>

        <span class="c1"># Determine values of the fields</span>
        <span class="n">v</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">prop</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">v</span>

        <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">field_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">lab</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">ent</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">ent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="n">field_values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">row</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">lab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>
            <span class="n">ent</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">YES</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field</span><span class="p">,</span> <span class="n">ent</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">focus</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Return&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">())</span>
        <span class="n">ok_button</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">)</span>
        <span class="n">ok_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">cancel_button</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Cancel&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
        <span class="n">cancel_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span>
                    <span class="s2">&quot;Incorrect value&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter a python style float, for example: 1e-2 or 0.01&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">focus_force</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">label</span>

        <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span>
                <span class="s2">&quot;No inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter a value or a label or both&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus_force</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">open_canvas</span><span class="p">(</span><span class="n">netlist_filename</span><span class="p">):</span>
    <span class="c1"># root = tk.Tk()</span>
    <span class="c1"># canvas = SnappingCanvas(root,</span>
    <span class="c1">#                         netlist_filename=netlist_filename, grid_unit=60, bg=&quot;white&quot;)</span>
    <span class="c1"># root.focus_force()</span>
    <span class="c1"># root.mainloop()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">(),</span> <span class="n">netlist_filename</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>


<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../../_autosummary/Qcircuits.gui.html#Qcircuits.gui.MainWindow">[docs]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Main window class &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mainframe</span><span class="p">,</span> <span class="n">netlist_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the main Frame &quot;&quot;&quot;</span>
        <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">mainframe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Circuit Editor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s1">&#39;800x600&#39;</span><span class="p">)</span>  <span class="c1"># size of the main window</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">iconbitmap</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;C:\ProgramData\Anaconda3\Lib\site-packages\Qcircuits\artwork\logo.ico&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Anticipating possible non-Windows related issues</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There has been an error loading the applications icon:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># make canvas expandable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">SnappingCanvas</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">,</span> <span class="n">netlist_filename</span><span class="o">=</span><span class="n">netlist_filename</span><span class="p">,</span> <span class="n">grid_unit</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">open_canvas</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Mario Gely

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>